<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>跨域 | VC&#39;s Blog</title>
    <meta name="description" content="记录一下叭🐌">
    
    
    <link rel="preload" href="/assets/css/0.styles.058b2d67.css" as="style"><link rel="preload" href="/assets/js/app.3d620a6f.js" as="script"><link rel="preload" href="/assets/js/27.dd5f26e2.js" as="script"><link rel="prefetch" href="/assets/js/10.0ab68627.js"><link rel="prefetch" href="/assets/js/11.79396d94.js"><link rel="prefetch" href="/assets/js/12.c84ca706.js"><link rel="prefetch" href="/assets/js/13.cc9287f8.js"><link rel="prefetch" href="/assets/js/14.69138d78.js"><link rel="prefetch" href="/assets/js/15.971bb51c.js"><link rel="prefetch" href="/assets/js/16.1e10d839.js"><link rel="prefetch" href="/assets/js/17.e96aff6e.js"><link rel="prefetch" href="/assets/js/18.5ee51ef9.js"><link rel="prefetch" href="/assets/js/19.dfabf67f.js"><link rel="prefetch" href="/assets/js/2.fe4a76b1.js"><link rel="prefetch" href="/assets/js/20.45e6fa32.js"><link rel="prefetch" href="/assets/js/21.9d90f167.js"><link rel="prefetch" href="/assets/js/22.bc222999.js"><link rel="prefetch" href="/assets/js/23.50e02b83.js"><link rel="prefetch" href="/assets/js/24.196726eb.js"><link rel="prefetch" href="/assets/js/25.35b23e5c.js"><link rel="prefetch" href="/assets/js/26.30b67b5e.js"><link rel="prefetch" href="/assets/js/28.5bb22549.js"><link rel="prefetch" href="/assets/js/29.cd1a78d5.js"><link rel="prefetch" href="/assets/js/3.b6b016ad.js"><link rel="prefetch" href="/assets/js/30.a08bb659.js"><link rel="prefetch" href="/assets/js/31.b6a25c09.js"><link rel="prefetch" href="/assets/js/4.975d3a1f.js"><link rel="prefetch" href="/assets/js/5.e5a53480.js"><link rel="prefetch" href="/assets/js/6.3c214a26.js"><link rel="prefetch" href="/assets/js/7.29aba97e.js"><link rel="prefetch" href="/assets/js/8.2c61a77c.js"><link rel="prefetch" href="/assets/js/9.c38e0b2c.js">
    <link rel="stylesheet" href="/assets/css/0.styles.058b2d67.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">VC's Blog</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">Home</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">notes</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/js/" class="nav-link router-link-active">javaScript</a></li><li class="dropdown-item"><!----> <a href="/html/" class="nav-link">HTML/CSS</a></li><li class="dropdown-item"><!----> <a href="/http/" class="nav-link">Http/浏览器/性能</a></li><li class="dropdown-item"><h4>后端</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/nodejs/" class="nav-link">NodeJs</a></li></ul></li></ul></div></div><div class="nav-item"><a href="/about.html" class="nav-link">About</a></div><div class="nav-item"><a href="https://github.com/wht1995" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">Home</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">notes</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/js/" class="nav-link router-link-active">javaScript</a></li><li class="dropdown-item"><!----> <a href="/html/" class="nav-link">HTML/CSS</a></li><li class="dropdown-item"><!----> <a href="/http/" class="nav-link">Http/浏览器/性能</a></li><li class="dropdown-item"><h4>后端</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/nodejs/" class="nav-link">NodeJs</a></li></ul></li></ul></div></div><div class="nav-item"><a href="/about.html" class="nav-link">About</a></div><div class="nav-item"><a href="https://github.com/wht1995" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/js/" class="sidebar-link">说明</a></li><li><a href="/js/closure.html" class="sidebar-link">闭包</a></li><li><a href="/js/crossOrigin.html" class="active sidebar-link">跨域</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/js/crossOrigin.html#❓什么是跨域" class="sidebar-link">❓什么是跨域</a></li><li class="sidebar-sub-header"><a href="/js/crossOrigin.html#🍎jsonp" class="sidebar-link">🍎JSONP</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/js/crossOrigin.html#jsonp-优-缺" class="sidebar-link">JSONP 优/缺</a></li></ul></li><li class="sidebar-sub-header"><a href="/js/crossOrigin.html#🥔cors" class="sidebar-link">🥔CORS</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/js/crossOrigin.html#两种请求" class="sidebar-link">两种请求</a></li><li class="sidebar-sub-header"><a href="/js/crossOrigin.html#简单请求" class="sidebar-link">简单请求</a></li><li class="sidebar-sub-header"><a href="/js/crossOrigin.html#非简单请求" class="sidebar-link">非简单请求</a></li></ul></li></ul></li><li><a href="/js/Event-Loop.html" class="sidebar-link">Event-Loop</a></li><li><a href="/js/debounce_throttle.html" class="sidebar-link">防抖与节流</a></li><li><a href="/js/class_basic.html" class="sidebar-link">Class 的基本语法</a></li><li><a href="/js/class_inherit.html" class="sidebar-link">Class 的继承</a></li><li><a href="/js/Set_WeakSet.html" class="sidebar-link">Set 数据结构</a></li><li><a href="/js/Map_WeakMap.html" class="sidebar-link">Map 数据结构</a></li><li><a href="/js/Vue 生命周期.html" class="sidebar-link">Vue 生命周期</a></li><li><a href="/js/Vue 组件路由懒加载.html" class="sidebar-link">Vue 组件/路由懒加载</a></li><li><a href="/js/js1.html" class="sidebar-link">JavaScript 基础</a></li></ul> </div> <div class="page"> <div class="content"><h1 id="跨域"><a href="#跨域" aria-hidden="true" class="header-anchor">#</a> 跨域</h1> <p>推荐阅读：<a href="https://juejin.im/post/5c23993de51d457b8c1f4ee1" target="_blank" rel="noopener noreferrer">文章 1<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> | <a href="https://juejin.im/post/5a6320d56fb9a01cb64ee191" target="_blank" rel="noopener noreferrer">文章 2<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h2 id="❓什么是跨域"><a href="#❓什么是跨域" aria-hidden="true" class="header-anchor">#</a> ❓什么是跨域</h2> <p>跨域，是因为受到浏览器 <strong>同源策略</strong> 的限制而出现的问题。如果如果缺少了同源策略的保护，浏览器就很容易收到 XSS、CSRF 等攻击。</p> <p>同源，即是指 URL 中的 <strong>协议</strong> 、<strong>域名</strong>、<strong>端口号</strong> 三者都相同，如果三者有其一不相同，即为 <strong>非同源</strong> 。</p> <p>同源策略限制了什么？</p> <ul><li>无法获取不同源的 cookie、LocalStorage、IndexedDB 等存储性内容</li> <li>BOM 和 DOM</li> <li>AJAX 请求发送后，结果被浏览器拦截了</li></ul> <p>关于跨域的误区：</p> <p><strong>跨域请求能发出去，服务端能收到请求并正常返回结果，只是结果被浏览器拦截了</strong>。</p> <h2 id="🍎jsonp"><a href="#🍎jsonp" aria-hidden="true" class="header-anchor">#</a> 🍎JSONP</h2> <p>利用 <code>&lt;script&gt;</code> 标签没有跨域限制的漏洞，可以得到从其他源产生的数据。JSONP请求一定需要对方的服务器做支持才可以。</p> <p>服务端代码：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> http <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'http'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">/* JSONP */</span>
http<span class="token punctuation">.</span><span class="token function">createServer</span><span class="token punctuation">(</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> method <span class="token operator">=</span> req<span class="token punctuation">.</span>url<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">'='</span><span class="token punctuation">)</span><span class="token punctuation">;</span>	<span class="token comment">//获取请求参数</span>
    
    res<span class="token punctuation">.</span><span class="token function">writeHead</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token string">&quot;Content-type&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;text/html;charset=utf-8&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>method<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">(123)`</span></span><span class="token punctuation">)</span>	<span class="token comment">//拼接成执行函数形式</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">1337</span><span class="token punctuation">)</span>
</code></pre></div><p>前端 <strong>JSONP  ：</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//定义回调函数</span>
<span class="token keyword">const</span> <span class="token function-variable function">handleResponse</span> <span class="token operator">=</span> data <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// 构造 &lt;script&gt; 标签</span>
    <span class="token keyword">let</span> script <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">&quot;script&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    script<span class="token punctuation">.</span>src <span class="token operator">=</span> <span class="token string">&quot;http://127.0.0.1:1337?callback=handleResponse&quot;</span><span class="token punctuation">;</span>

<span class="token comment">// 向document中添加 &lt;script&gt; 标签，并且发送GET请求</span>
    document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>script<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>前端发送 <code>GET</code> 请求后，服务端获取请求参数，然后拼接成执行函数的字符串形式返回给客户端。这时候，前端拿到的返回结果相当于：<code>&lt;script&gt; handleResponse(123) &lt;/script&gt;</code> ，再找到先前定义好的回调函数，就可以成功输出 <code>data</code> 了。</p> <h3 id="jsonp-优-缺"><a href="#jsonp-优-缺" aria-hidden="true" class="header-anchor">#</a> JSONP 优/缺</h3> <ul><li>兼容性好，可用于解决主流浏览器的跨域数据访问的问题</li> <li>仅仅支持 GET 方法请求</li> <li>不安全，有遭受 XSS 等攻击的可能性</li></ul> <h2 id="🥔cors"><a href="#🥔cors" aria-hidden="true" class="header-anchor">#</a> 🥔CORS</h2> <p>CORS 是一个 W3C 标准，全称是&quot;跨域资源共享&quot;（Cross-origin resource sharing）。</p> <p>它允许浏览器向跨源服务器，发出 <code>XMLHttpRequest</code> 请求，从而克服了AJAX只能同源使用的限制。</p> <p>CORS 需要浏览器和服务器同时支持。</p> <h3 id="两种请求"><a href="#两种请求" aria-hidden="true" class="header-anchor">#</a> 两种请求</h3> <p>只要同时满足以下两大条件，就属于简单请求。</p> <p>① 请求方法是以下三选一</p> <ul><li>HEAD</li> <li>GET</li> <li>POST</li></ul> <p>② HTTP 的头部信息不超出以下字段</p> <ul><li>Accept</li> <li>Accept-Language</li> <li>Content-Language</li> <li>Last-Event-ID</li> <li>Content-Type：只限于三个值 <code>application/x-www-form-urlencoded</code> | <code>multipart/form-data</code> | <code>text/plain</code></li></ul> <p>凡是不同时满足上面两个条件，就属于非简单请求。</p> <h3 id="简单请求"><a href="#简单请求" aria-hidden="true" class="header-anchor">#</a> 简单请求</h3> <p>对于简单请求，浏览器直接发出 CORS 请求。具体来说，就是在头信息之中，增加一个<code>Origin</code>字段。</p> <p><code>Origin</code> 字段用来说明，此次请求来自哪个源（协议 + 域名 + 端口）</p> <p>如果 <code>Origin</code> 在服务器允许请求的范围内，则跨域请求成功，反之，失败。</p> <p>Node 服务端代码如下</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> http <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'http'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">/* CROS */</span>
http<span class="token punctuation">.</span><span class="token function">createServer</span><span class="token punctuation">(</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    res<span class="token punctuation">.</span><span class="token function">writeHead</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
        <span class="token string">&quot;Access-Control-Allow-Origin&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;*&quot;</span><span class="token punctuation">,</span>
        <span class="token comment">// &quot;Access-Control-Allow-Credentials&quot;: true,</span>
        <span class="token comment">// &quot;Access-Control-Allow-Methods&quot;: &quot;DELETE, PUT&quot;,</span>
        <span class="token comment">// &quot;Access-Control-Allow-Headers&quot;: &quot;Content-Type,X-Requested-With&quot;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token string">&quot;跨域成功&quot;</span><span class="token punctuation">)</span>

<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">1337</span><span class="token punctuation">)</span>
</code></pre></div><p>前端请求</p> <div class="language-js extra-class"><pre class="language-js"><code>axios<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">&quot;http://127.0.0.1:1337/&quot;</span><span class="token punctuation">)</span>
	<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span> data <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token keyword">catch</span><span class="token punctuation">(</span>err <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><p><code>Access-Control-Allow-Origin</code> 这个字段是必须的。它的值要么是请求时 <code>Origin</code> 字段的值，要么是一个 <code>*</code>，表示接受任意域名的请求。</p> <p>其余字段更多信息，看 <a href="http://www.ruanyifeng.com/blog/2016/04/cors.html" target="_blank" rel="noopener noreferrer">阮一峰博客<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h3 id="非简单请求"><a href="#非简单请求" aria-hidden="true" class="header-anchor">#</a> 非简单请求</h3> <p>非简单请求的 CORS，会在正式通信之前，增加一次 HTTP 查询，这个称为“预检”请求（preflight）。</p> <p><strong>预检的意义在于：</strong> 浏览器先询问服务器，当前网页所在的域名是否在服务器的许可名单之中，以及可以使用哪些HTTP动词和头信息字段。只有得到肯定答复，浏览器才会发出正式的 <code>XMLHttpRequest</code> 请求，否则就报错。</p> <p>我们发送一次非简单请求：</p> <div class="language-js extra-class"><pre class="language-js"><code>axios<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;http://127.0.0.1:1337/&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span> data <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token keyword">catch</span><span class="token punctuation">(</span>err <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><p>这里我们使用 <code>PUT</code> 方法发送请求，服务端代码如下：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> http <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'http'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">/* CROS */</span>
http<span class="token punctuation">.</span><span class="token function">createServer</span><span class="token punctuation">(</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    res<span class="token punctuation">.</span><span class="token function">writeHead</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
        <span class="token string">&quot;Access-Control-Allow-Origin&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;*&quot;</span><span class="token punctuation">,</span>
        <span class="token string">&quot;Access-Control-Allow-Methods&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;DELETE, PUT&quot;</span><span class="token punctuation">,</span>
        <span class="token string">&quot;Access-Control-Allow-Headers&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;Content-Type,X-Requested-With&quot;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token string">&quot;跨域成功&quot;</span><span class="token punctuation">)</span>

<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">1337</span><span class="token punctuation">)</span>
</code></pre></div><p>我们打开 F12 到 Network 面板，因为是非简单请求，所以可以看到浏览器发送了两次请求。</p> <p>一次“预检”请求，一次正式通信请求。下面是这个&quot;预检&quot;请求的 HTTP 响应头信息如下：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token constant">OPTIONS</span> <span class="token operator">/</span>cors <span class="token constant">HTTP</span><span class="token operator">/</span><span class="token number">1.1</span>
 Access<span class="token operator">-</span>Control<span class="token operator">-</span>Allow<span class="token operator">-</span>Headers<span class="token punctuation">:</span> Content<span class="token operator">-</span>Type<span class="token punctuation">,</span><span class="token constant">X</span><span class="token operator">-</span>Requested<span class="token operator">-</span>With
 Access<span class="token operator">-</span>Control<span class="token operator">-</span>Allow<span class="token operator">-</span>Methods<span class="token punctuation">:</span> <span class="token constant">DELETE</span><span class="token punctuation">,</span> <span class="token constant">PUT</span>
 Access<span class="token operator">-</span>Control<span class="token operator">-</span>Allow<span class="token operator">-</span>Origin<span class="token punctuation">:</span> <span class="token operator">*</span>
 Connection<span class="token punctuation">:</span> keep<span class="token operator">-</span>alive
 Date<span class="token punctuation">:</span> Tue<span class="token punctuation">,</span> <span class="token number">31</span> Dec <span class="token number">2019</span> <span class="token number">08</span><span class="token punctuation">:</span><span class="token number">21</span><span class="token punctuation">:</span><span class="token number">27</span> <span class="token constant">GMT</span>
 Transfer<span class="token operator">-</span>Encoding<span class="token punctuation">:</span> chunked
</code></pre></div><p>&quot;预检&quot;请求用的请求方法是 <code>OPTIONS</code> ，表示这个请求是用来询问的。头信息里面，关键字段是 <code>Origin</code>，表示请求来自哪个源。</p> <p>除了 <code>Origin</code> 字段，&quot;预检&quot;请求的头信息包括两个特殊字段。</p> <p><strong>（1）Access-Control-Request-Method</strong></p> <p>该字段是必须的，用来列出浏览器的 CORS 请求可以用到哪些HTTP方法，上例是 <code>PUT</code> 、<code>DELETE</code>。</p> <p><strong>（2）Access-Control-Request-Headers</strong></p> <p>该字段是一个逗号分隔的字符串，指定浏览器 CORS 请求会额外发送的头信息字段。</p></div> <div class="page-edit"><!----> <!----></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/js/closure.html" class="prev">
          闭包
        </a></span> <span class="next"><a href="/js/Event-Loop.html">
          Event-Loop
        </a>
        →
      </span></p></div> </div> <!----></div></div>
    <script src="/assets/js/app.3d620a6f.js" defer></script><script src="/assets/js/27.dd5f26e2.js" defer></script>
  </body>
</html>
