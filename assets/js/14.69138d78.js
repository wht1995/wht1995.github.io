(window.webpackJsonp=window.webpackJsonp||[]).push([[14],{205:function(t,s,e){"use strict";e.r(s);var a=e(0),n=Object(a.a)({},function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("div",{staticClass:"content"},[t._m(0),t._v(" "),e("p",[t._v("对于 web 客户端的攻击，除了 XSS 首当其冲，CSRF 也是一个很常见的安全漏洞。")]),t._v(" "),t._m(1),t._v(" "),e("p",[t._v("本文意在简单地了解 CSRF 攻击方式。"),e("a",{attrs:{href:"https://juejin.im/post/5b6bf1136fb9a04fda4e4265#heading-4",target:"_blank",rel:"noopener noreferrer"}},[t._v("参考链接"),e("OutboundLink")],1)]),t._v(" "),e("p",[e("a",{attrs:{href:"https://www.hacksplaining.com/exercises/csrf#",target:"_blank",rel:"noopener noreferrer"}},[t._v("攻击演示"),e("OutboundLink")],1)]),t._v(" "),t._m(2),t._v(" "),e("p",[t._v("攻击者诱导受害者进入第三方网站，在第三方网站中，向被攻击网站发送跨站情求。利用受害者在被攻击网站的被信任的身份，绕过后台的用户验证，达到冒充用户对被攻击网站执行某些恶意操作的目的。")]),t._v(" "),t._m(3),t._v(" "),t._m(4),t._v(" "),t._m(5),t._v(" "),t._m(6),t._v(" "),t._m(7),t._v(" "),t._m(8),t._m(9),t._v(" "),t._m(10),t._m(11),t._v(" "),t._m(12),t._m(13),t._v(" "),t._m(14),t._v(" "),t._m(15),t._v(" "),t._m(16),t._v(" "),t._m(17),t._v(" "),t._m(18)])},[function(){var t=this.$createElement,s=this._self._c||t;return s("h1",{attrs:{id:"csrf-攻击"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#csrf-攻击","aria-hidden":"true"}},[this._v("#")]),this._v(" CSRF 攻击")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("CSRF 名为“跨站请求伪造”（Cross-Site Request Forgery），顾名思义，就是指攻击者在受害用户的浏览器端植入恶意代码，然后获取用户的敏感信息如：cookie、session，然后冒充用户身份，"),s("strong",[this._v("恶意伪造")]),this._v(" 一个 http 请求发送给服务器，从而达到攻击者的目的。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"csrf-攻击方式"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#csrf-攻击方式","aria-hidden":"true"}},[this._v("#")]),this._v(" CSRF 攻击方式")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[s("strong",[this._v("典型流程：")])])},function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("ul",[e("li",[t._v("受害者登陆 "),e("code",[t._v("a.com")]),t._v(" ，并保留了登陆凭证（cookie）")]),t._v(" "),e("li",[t._v("攻击者诱使受害者访问第三方网站 "),e("code",[t._v("b.com")])]),t._v(" "),e("li",[e("code",[t._v("b.com")]),t._v(" 向 "),e("code",[t._v("a.com")]),t._v(" 发送了一个请求："),e("code",[t._v("a.com/act = xxx")])]),t._v(" "),e("li",[e("code",[t._v("a.com")]),t._v(" 接收到请求后，"),e("strong",[t._v("对请求进行验证，并确认是受害者的凭证，误以为是受害者自己发送的请求")])]),t._v(" "),e("li",[e("code",[t._v("a.com")]),t._v(" 以受害者的名义执行了act=xxx")]),t._v(" "),e("li",[t._v("攻击完成，攻击者在受害者不知情的情况下，冒充受害者，让 "),e("code",[t._v("a.com")]),t._v(" 执行了自己定义的操作")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[s("strong",[this._v("常见攻击类型：")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("ul",[s("li",[this._v("GET 类型的 CSRF")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("假设有一个 bbs 站点："),s("code",[this._v("http://www.c.com")]),this._v("，当登录后的用户发起如下 GET 请求时，会删除 ID 指定的帖子：")])},function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("div",{staticClass:"language-js extra-class"},[e("pre",{pre:!0,attrs:{class:"language-js"}},[e("code",[t._v("http"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("www"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("c"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("com"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("8002")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("content"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("delete")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("id\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("如发起 "),s("code",[this._v("http://www.c.com:8002/content/delete/87343")]),this._v(" 请求时，会删除 id 为 87343 的帖子。当用户登录之后，会设置如下 cookie：")])},function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("div",{staticClass:"language-js extra-class"},[e("pre",{pre:!0,attrs:{class:"language-js"}},[e("code",[t._v("res"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("setHeader")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Set-Cookie'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'user=22333; expires=Sat, 21 Jul 2018 00:00:00 GMT;'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[s("code",[this._v("user")]),this._v(" 对应的值是用户 ID。然后攻击者构造一个页面 A：")])},function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("div",{staticClass:"language-html extra-class"},[e("pre",{pre:!0,attrs:{class:"language-html"}},[e("code",[e("span",{pre:!0,attrs:{class:"token tag"}},[e("span",{pre:!0,attrs:{class:"token tag"}},[e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("p")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("CSRF 攻击者准备的网站："),e("span",{pre:!0,attrs:{class:"token tag"}},[e("span",{pre:!0,attrs:{class:"token tag"}},[e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("p")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token tag"}},[e("span",{pre:!0,attrs:{class:"token tag"}},[e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("img")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("src")]),e("span",{pre:!0,attrs:{class:"token attr-value"}},[e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("http://www.c.com:8002/content/delete/87343"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("页面 A 使用了一个 "),s("code",[this._v("img")]),this._v(" 标签，其地址指向了删除用户帖子的链接.")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("当登录用户访问攻击者的网站时，会向 "),s("code",[this._v("www.c.com")]),this._v(" 发起一个删除用户帖子的请求。此时若用户在切换到 "),s("code",[this._v("www.c.com")]),this._v(" 的帖子页面刷新，会发现ID 为 87343 的帖子已经被删除。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[s("strong",[this._v("CSRF的特点")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("ul",[s("li",[this._v("攻击一般发起在第三方网站，而不是被攻击的网站。被攻击的网站无法防止攻击发生。")]),this._v(" "),s("li",[this._v("攻击利用受害者在被攻击网站的登录凭证，冒充受害者提交操作；而不是直接窃取数据。")]),this._v(" "),s("li",[this._v("整个过程攻击者并不能获取到受害者的登录凭证，仅仅是“冒用”。")]),this._v(" "),s("li",[this._v("跨站请求可以用各种方式：图片URL、超链接、CORS、Form提交等等。部分请求方式可以直接嵌入在第三方论坛、文章中，难以进行追踪。")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[s("strong",[this._v("如何防御")])])},function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("ul",[e("li",[e("p",[t._v("验证 Referer")]),t._v(" "),e("p",[t._v("请求头中的 "),e("code",[t._v("Referer")]),t._v(" 可以判断请求的来源。我们可以通过验证 "),e("code",[t._v("Referer")]),t._v(" 来判断改请求是不是第三方网站发起的。")])]),t._v(" "),e("li",[e("p",[t._v("验证 Origin")]),t._v(" "),e("p",[t._v("Origin字段内包含发起请求的域名，如果Origin存在，那么直接使用Origin中的字段确认来源域名就可以。")])]),t._v(" "),e("li",[e("p",[t._v("Token")]),t._v(" "),e("p",[t._v("服务器下发一个随机 Token，每次发起请求时将 Token 携带上，服务器验证 Token 是否有效。")])]),t._v(" "),e("li",[e("p",[t._v("验证码")]),t._v(" "),e("p",[t._v("证码被认为是对抗 CSRF 攻击最简洁而有效的防御方法。从上述示例中可以看出，CSRF 攻击往往是在用户不知情的情况下构造了网络请求。而验证码会强制用户必须与应用进行交互，才能完成最终请求。因为通常情况下，验证码能够很好地遏制 CSRF 攻击。")])])])}],!1,null,null,null);s.default=n.exports}}]);